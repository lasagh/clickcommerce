!function(a){var e;a(document).ready(function(){a("#phone").mask("(99)9999-9999"),a("#phone_mobile").mask("(99)9999-99999"),a(".moipay .pchoice").click(function(){a(".moipay .pchoice").removeClass("active-choice"),a(this).addClass("active-choice")})}),MoipPagamentos=function(){a('input[name="payment"]').click(function(){var e=this.value;a(".escolha:visible").fadeOut(),a("#"+e).fadeIn(),a("input:radio[name=payment]").each(function(){a(this).is(":checked")&&(paymentForm=a(this).attr("id"))}),a("input:hidden[name=paymentForm]").val(paymentForm),a("#telefonePortador").mask("(99)9999-9999"),a("#cpfPortador").mask("999.999.999-99"),a("#dataPortador").mask("99/99/9999"),"AmericanExpress"==paymentForm?(a("#cartaoNumero").mask("9999 999999 99999?9"),a("#segurancaNumero").mask("9999")):"Diners"==paymentForm?(a("#cartaoNumero").mask("9999 999999 9999"),a("#segurancaNumero").mask("999")):"Hipercard"==paymentForm?(a("#cartaoNumero").mask("9999 9999 9999 9999?999"),a("#segurancaNumero").mask("999")):"Mastercard"==paymentForm?(a("#cartaoNumero").mask("9999 9999 9999 9999"),a("#segurancaNumero").mask("999")):"Visa"==paymentForm?(a("#cartaoNumero").mask("9999 9999 9999 9999"),a("#segurancaNumero").mask("999")):(a("#cartaoNumero").mask("9999 9999 99999 999?9"),a("#segurancaNumero").mask("999?9"))}),a("#Credito").length&&calcParcel(),a("select[name=parcelamentoCartao]").click(function(){parcelamentoCartao=a("select[name=parcelamentoCartao]").find("option").filter(":selected").attr("title"),a(".parcelamentoCartao").text(parcelamentoCartao)}),a(".exclusive").click(function(){e=a(this).attr("id"),"CartaoCredito"==e?a(".formulario").validate({rules:{telefonePortador:{required:!0},nomePortador:{required:!0},dataPortador:{required:!0},cpfPortador:{required:!0}},messages:{cartaoNumero:"Informe o número do cartão de crédito corretamente",segurancaNumero:"Preencha o código de segurança",cartaoMes:"Preencha o mês de vencimento do cartão",cartaoAno:"Preencha o ano de vencimento do cartão",telefonePortador:"Preencha o telefone do titular do cartão (<i>Ex. (11)1111-1111</i>)",nomePortador:"Preencha o nome do titular do cartão",dataPortador:"Preencha a data de nascimento do titular do cartão (<i>Ex. 30/11/1980</i>)",cpfPortador:"Preencha o CPF do titular do cartão (<i>Ex. 111.111.111-11</i>)"},errorClass:"validate_erro",errorElement:"li",ignore:".ignore",errorLabelContainer:"#alert-area",submitHandler:function(){sendToCreditCard()}}):"DebitoBancario"==e?(a.removeData(a(".formulario").get(0)),a(".formulario").validate({ignore:".required",submitHandler:function(){sendToDebito()}})):"BoletoBancario"==e&&(a.removeData(a(".formulario").get(0)),a(".formulario").validate({ignore:".required",submitHandler:function(){sendToBoleto()}}))})},calcParcel=function(){if(a("input[name=tokenToMoip]").val()){a("#MoipWidget").attr("data-token",a("input[name=tokenToMoip]").val());var e={cofre:"",instituicao:"Visa",callback:"retornoCalculoParcelamento"};MoipUtil.calcularParcela(e),a(".pagamentoParcelado").remove()}},removeParcel=function(){a(".pagamentoParcelado").remove(),a("#calcular").removeAttr("disabled")},retornoCalculoParcelamento=function(e){a.each(e.parcelas,function(e,o){1!=o.quantidade&&(o.valor=o.valor.split(".").join(","),o.valor_total=o.valor_total.split(".").join(","),a("#parcelamentoCartao").append('<option value="'+o.quantidade+'" label="'+o.quantidade+" x R$ "+o.valor+'" title="Total de R$ '+o.valor_total+'" class="pagamentoParcelado">'+o.quantidade+" x R$ "+o.valor+"</option>"))})},sendToCreditCard=function(){a("#MoipWidget").attr("data-token",tokenIsEmpty()),cartaoValidade=a("select[name=cartaoMes]").val()+"/"+a("select[name=cartaoAno]").val(),cartaoFormatado=a("input[name=cartaoNumero]").val(),cartaoNumero=cartaoFormatado.split(" ").join("");var e={Forma:"CartaoCredito",Instituicao:a("input[name=paymentForm]").val(),Parcelas:a("select[name=parcelamentoCartao]").val(),Recebimento:"AVista",CartaoCredito:{Numero:cartaoNumero,Expiracao:cartaoValidade,CodigoSeguranca:a("input[name=segurancaNumero]").val(),Portador:{Nome:a("input[name=nomePortador]").val(),DataNascimento:a("input[name=dataPortador]").val(),Telefone:a("input[name=telefonePortador]").val(),Identidade:a("input[name=cpfPortador]").val()}}};disableButton("CartaoCredito"),MoipWidget(e)},sendToBoleto=function(){a("#MoipWidget").attr("data-token",tokenIsEmpty());var e={Forma:"BoletoBancario"};disableButton("BoletoBancario"),MoipWidget(e)},sendToDebito=function(){a("#MoipWidget").attr("data-token",tokenIsEmpty());var e={Forma:"DebitoBancario",Instituicao:paymentForm};disableButton("DebitoBancario"),MoipWidget(e)},callbackSuccess=function(a){retSuccess(a)},callbackError=function(a){"Falha"==a.StatusPagamento?retErrorServer(a):retError(a),enableButton(e)},retSuccess=function(o){void 0!=o.CodigoMoIP?"Cancelado"==o.Status?(moipClassification=o.Classificacao?o.Classificacao.Descricao:"Erro de processamento",a.ajax({type:"POST",url:"../../modules/moip/validation.php?type=redirect",dataType:"json",data:{paymentForm:"CartaoCredito",paymentFormInstitution:paymentForm,paymentMessage:o.Mensagem,paymentCode:o.CodigoMoIP,paymentStatus:o.Status,paymentValue:o.TotalPago,idTransaction:a("input[name=uniqueIdForMoip]").val(),tokenTransaction:a("input[name=tokenToMoip]").val(),id_cart:a("input[name=idCart]").val(),paymentClassification:moipClassification},success:function(o){o.redirect?(a(".warning_line").remove(),a("#p_warning").addClass("warning"),a("#p_warning").append('<span class="warning_line">Seu pagamento não pode ser concluído.</span>'),a("#p_warning").append('<span class="warning_line"><br>Verifique os dados preenchidos ou se preferir utilize outro cartão.</span>'),o.classification,a(".div_debito_moip").fadeOut(),a(".div_boleto_moip").fadeOut(),enableButton(e)):retErrorServer(o)}})):a.ajax({type:"POST",url:"../../modules/moip/validation.php?type=redirect",dataType:"json",data:{paymentForm:"CartaoCredito",paymentFormInstitution:paymentForm,paymentMessage:o.Mensagem,paymentCode:o.CodigoMoIP,paymentStatus:o.Status,paymentValue:o.TotalPago,idTransaction:a("input[name=uniqueIdForMoip]").val(),tokenTransaction:a("input[name=tokenToMoip]").val(),id_cart:a("input[name=idCart]").val()},success:function(a){a.redirect?window.location.href=a.redirect:retErrorServer(a)}}):"BoletoMoip"==paymentForm?a.ajax({type:"POST",url:"../../modules/moip/validation.php?type=redirect",dataType:"json",data:{paymentForm:"BoletoBancario",paymentFormInstitution:paymentForm,paymentURL:o.url,paymentValue:a("input[name=valorAVista]").val(),idTransaction:a("input[name=uniqueIdForMoip]").val(),tokenTransaction:a("input[name=tokenToMoip]").val(),id_cart:a("input[name=idCart]").val()},success:function(a){a.redirect?window.location.href=a.redirect:retErrorServer(a)}}):a.ajax({type:"POST",url:"../../modules/moip/validation.php?type=redirect",dataType:"json",data:{paymentForm:"DebitoBancario",paymentFormInstitution:paymentForm,paymentURL:o.url,paymentValue:a("input[name=valorAVista]").val(),idTransaction:a("input[name=uniqueIdForMoip]").val(),tokenTransaction:a("input[name=tokenToMoip]").val(),id_cart:a("input[name=idCart]").val()},success:function(a){a.redirect?window.location.href=a.redirect:retErrorServer(a)}})},retError=function(e){e.StatusPagamento?retErrorServer(e):(a("#alert-area").show(),a.each(e,function(e,o){905==o.Codigo?(a("#cartaoNumero").addClass("validate_erro"),a("#alert-area").append('<li for="cartaoNumero" generated="true" class="validate_erro">Informe o número do cartão de crédito corretamente</li>')):906==o.Codigo?(a("#cartaoMes").addClass("validate_erro"),a("#alert-area").append('<li for="cartaoMes" generated="true" class="validate_erro">Preencha o mês de vencimento do cartão.</li>'),a("#cartaoAno").addClass("validate_erro"),a("#alert-area").append('<li for="cartaoAno" generated="true" class="validate_erro">Preencha o ano de vencimento do cartão.</li>')):907==o.Codigo?(a("#segurancaNumero").addClass("validate_erro"),a("#alert-area").append('<li for="segurancaNumero" generated="true" class="validate_erro">Preencha o código de segurança</li>')):909==o.Codigo?(a("#nomePortador").addClass("validate_erro"),a("#alert-area").append('<li for="nomePortador" generated="true" class="validate_erro">Preencha o nome do titular do cartão</li>')):910==o.Codigo?(a("#dataPortador").addClass("validate_erro"),a("#alert-area").append('<li for="dataPortador" generated="true" class="validate_erro">Preencha a data de nascimento do titular do cartão (<i>Ex. 30/11/1980</i></li>')):911==o.Codigo?(a("#telefonePortador").addClass("validate_erro"),a("#alert-area").append('<li for="telefonePortador" generated="true" class="validate_erro">Preencha o telefone do titular do cartão (<i>Ex. (11)1111-1111</i>)</li>')):912==o.Codigo&&(a("#cpfPortador").addClass("validate_erro"),a("#alert-area").append('<li for="cpfPortador" generated="true" class="validate_erro">Preencha o CPF do titular do cartão (<i>Ex. 111.111.111-11</i>)</li>'))}))},retErrorServer=function(e){a.ajax({type:"POST",url:"../../modules/moip/validation.php?type=log",dataType:"json",data:e}),alert("Ocorreu um erro ao finalizar seu pagamento.\nTente novamente."),window.location.reload()},disableButton=function(e){a("#"+e).attr("disabled","disabled"),a("#"+e).removeClass("exclusive"),a("#"+e).addClass("exclusive_disabled"),a("#spinner"+e).fadeIn()},enableButton=function(e){a("#"+e).removeAttr("disabled"),a("#"+e).removeClass("exclusive_disabled"),a("#"+e).addClass("exclusive"),a("#spinner"+e).fadeOut()},tokenIsEmpty=function(){return(tokenMoip=a("input[name=tokenToMoip]").val())?tokenMoip:(moipRequest=a("input[name=moipRequest]").val(),retErrorServer(moipRequest),void 0)}}(jQuery);